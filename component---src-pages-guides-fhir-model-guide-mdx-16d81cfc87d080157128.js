(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"WVQ/":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return s})),n.d(t,"default",(function(){return d}));n("tkto"),n("yXV3"),n("pNMO"),n("zKZe"),n("q1tI");var a=n("7ljp"),r=n("013z"),i=(n("qKvR"),["components"]);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s={},b={_frontmatter:s},c=r.a;function d(e){var t=e.components,n=l(e,i);return Object(a.b)(c,o({},b,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Overview"),Object(a.b)("p",null,"The FHIR model component provides Java APIs for parsing, building, generating and validating FHIR resources. Java model classes that represent FHIR resources and data types are generated directly from the structure definitions distributed with the spec. All model objects are thread-safe and immutable. Each model class implements the Java builder pattern (Effective Java, Joshua Bloch) and the visitor pattern (GoF). The classes also implement Java equals, hashCode and toString methods. All date/time processing is done using the Java time library."),Object(a.b)("p",null,"Many of the data type classes include additional factory methods to facilitate object construction for common use cases. The model includes generated Javadoc comments complete with excerpts taken directly from the specification. Model classes also include Java annotations for constraints (",Object(a.b)("inlineCode",{parentName:"p"},"@Constraint"),"), required elements (",Object(a.b)("inlineCode",{parentName:"p"},"@Required"),"), choice element types (",Object(a.b)("inlineCode",{parentName:"p"},"@Choice"),") and value set bindings (",Object(a.b)("inlineCode",{parentName:"p"},"@Binding"),"). Value set bindings are implemented using Code subclasses with constant fields and nested enumerations. Backbone elements are implemented as Java nested classes to keep them organized."),Object(a.b)("p",null,"All schema-level (structure, cardinality, value domain) and global (empty resource, empty element) constraint validation is happens during object construction. This means that it is virtually impossible to build a schema invalid FHIR resource using the APIs. Additional constraint validation (invariants, profile, terminology) is performed using the FHIRValidator class. FHIRParser and FHIRGenerator classes are used to parse and generate both JSON and XML formats. FHIRPathEvaluator is a FHIRPath evaluation engine built on an ANTLR4 generated parser. It implements are large portion of the FHIRPath specification and is used for validation and search parameter value extraction."),Object(a.b)("h2",null,"Building a Resource using the FHIR Model API"),Object(a.b)("p",null,"The FHIR model API implements the Builder pattern for constructing Resource instances."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'Observation bodyWeight = Observation.builder()\n    .meta(Meta.builder()\n        .profile(Canonical.of("http://hl7.org/fhir/StructureDefinition/bodyweight"))\n        .build())\n    .status(ObservationStatus.FINAL)\n    .effective(DateTime.builder()\n        .value("2019-01-01")\n        .build())\n    .category(CodeableConcept.builder()\n        .coding(Coding.builder()\n            .system(Uri.of("http://terminology.hl7.org/CodeSystem/observation-category"))\n            .code(Code.of("vital-signs"))\n            .build())\n        .build())\n    .code(CodeableConcept.builder()\n        .coding(Coding.builder()\n            .system(Uri.of("http://loinc.org"))\n            .code(Code.of("29463-7"))\n            .build())\n        .build())\n    .value(Quantity.builder()\n        .value(Decimal.of(200))\n        .system(Uri.of("http://unitsofmeasure.org"))\n        .code(Code.of("[lb_av]"))\n        .unit(string("lbs"))\n        .build())\n    .build();\n')),Object(a.b)("p",null,"In the example above, a number of different builder classes are used:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Observation.Builder")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"DateTime.Builder")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"CodeableConcept.Builder")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Quantity.Builder"))),Object(a.b)("p",null,"Every type in the model that represents a FHIR resource or element has a corresponding nested, static Builder class used for constructing thread-safe, immutable instances."),Object(a.b)("p",null,"Several static factory / utility methods are also used:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Canonical.of(...)")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Uri.of(...)")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Code.of(...)")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"String.string(...)")," (via static import)")),Object(a.b)("p",null,"Many of the primitive data types contain this type of “helper” method."),Object(a.b)("p",null,"Fields from an immutable model object may be copied back into a builder object using the ",Object(a.b)("inlineCode",{parentName:"p"},"toBuilder()")," method:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"bodyWeight = bodyWeight.toBuilder()\n    .value(bodyWeight.getValue().as(Quantity.class).toBuilder()\n        .value(Decimal.of(210))\n        .build())\n    .build();\n")),Object(a.b)("h2",null,"Parsing a Resource from an InputStream or Reader"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'// Parse from InputStream\nInputStream in = getInputStream("JSON/bodyweight.json");\nObservation observation = FHIRParser.parser(Format.JSON).parse(in);\n\n// Parse from Reader\nReader reader = getReader("JSON/bodyweight.json");\nObservation observation = FHIRParser.parser(Format.JSON).parse(reader);\n')),Object(a.b)("h2",null,"Generating JSON and XML formats from a Resource instance"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"// Generate JSON format\nFHIRGenerator.generator(Format.JSON).generate(bodyWeight, System.out);\n\n// Generate XML format\nFHIRGenerator.generator(Format.XML).generate(bodyWeight, System.out);\n")),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"FHIRGenerator")," interface has a separate factory method that takes ",Object(a.b)("inlineCode",{parentName:"p"},"boolean prettyPrinting")," as a parameter:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"// Generate JSON format (with pretty printing)\nFHIRGenerator.generator(Format.JSON, true).generate(bodyWeight, System.out);\n")),Object(a.b)("h2",null,"Validating a Resource instance"),Object(a.b)("p",null,"Schema-level validation occurs during object construction. This includes validation of cardinality constraints and value domains. Additional validation of constraints specified in the model is performed using the ",Object(a.b)("inlineCode",{parentName:"p"},"FHIRValidator")," class."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"Observation observation = getObservation();\n\nList<Issue> issues = FHIRValidator.validator().validate(observation);\n\nfor (Issue issue : issues) {\n    if (IssueSeverity.ERROR.equals(issue.getSeverity())) {\n        // handle error\n    }\n}\n")),Object(a.b)("h2",null,"Evaluating FHIRPath expressions on a Resource instance"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'EvaluationContext evaluationContext = new EvaluationContext(bodyWeight);\nCollection<FHIRPathNode> result = FHIRPathEvaluator.evaluator().evaluate(evaluationContext, "Observation.value.as(Quantity).value >= 200");\nassert(FHIRPathUtil.isTrue(result));\n')),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"EvaluationContext")," class builds a ",Object(a.b)("inlineCode",{parentName:"p"},"FHIRPathTree")," from a FHIR resource or element. A ",Object(a.b)("inlineCode",{parentName:"p"},"FHIRPathTree")," is a tree of labeled nodes that wrap FHIR elements and are used by the FHIRPath evaluation engine (",Object(a.b)("inlineCode",{parentName:"p"},"FHIRPathEvaluator"),")."))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-fhir-model-guide-mdx-16d81cfc87d080157128.js.map