{"version":3,"sources":["webpack:///./src/pages/guides/FHIROperationFramework.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-guides-fhir-operation-framework-md-f0e06bf25ae56c640ee3.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/FHIR/FHIR/fhir/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`Extended Operations Framework`}</h1>\n    <p>{`The HL7 FHIR Specification describes a `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/operations.html\"\n      }}>{`framework`}</a>{` for operations that go beyond the standard REST API.`}</p>\n    <p>{`This framework defines REST endpoints at three different levels.`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Level`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Example`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><strong parentName=\"td\">{`System`}</strong></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><a parentName=\"td\" {...{\n              \"href\": \"https://my-server.com/fhir-server/api/v4/$convert\"\n            }}>{`https://my-server.com/fhir-server/api/v4/$convert`}</a></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Convert from one format to another`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><strong parentName=\"td\">{`Type`}</strong></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><a parentName=\"td\" {...{\n              \"href\": \"https://my-server.com/fhir-server/api/v4/Patient/$export\"\n            }}>{`https://my-server.com/fhir-server/api/v4/Patient/$export`}</a></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Retrieve all the data from the Patient compartment`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><strong parentName=\"td\">{`Instance`}</strong></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><a parentName=\"td\" {...{\n              \"href\": \"https://my-server.com/fhir-server/api/v4/Patient/1-2-3-4/$export\"\n            }}>{`https://my-server.com/fhir-server/api/v4/Patient/1-2-3-4/$export`}</a></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Retrieve a specific Patient data from the Patient compartment data`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`A list of operations supported by the LinuxForHealth FHIR Server is listed at `}<a parentName=\"p\" {...{\n        \"href\": \"https://linuxforhealth.github.io/FHIR/Conformance/#extended-operations\"\n      }}>{`https://linuxforhealth.github.io/FHIR/Conformance/#extended-operations`}</a></p>\n    <h2>{`Calling an Operation`}</h2>\n    <p>{`There are two types of operation invocation requests:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Complex (via POST)`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`All operations can be invoked by passing a Parameters resource instance in the body of the request.`}</li>\n          <li parentName=\"ul\">{`For operations with no input parameters, no body is required.`}</li>\n          <li parentName=\"ul\">{`For operations with a single input parameter named “resource”, the Parameters wrapper can be omitted.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Simple (via GET)`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Operations with only primitive input parameters (i.e. no complex datatypes like ‘Identifier’ or ‘Reference’) can be invoked via HTTP GET by passing the parameters in the URL.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <h3>{`Example: Complex`}</h3>\n    <p><em parentName=\"p\">{`Request`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`curl --location --request POST 'https://localhost:9443/fhir-server/api/v4/Patient/$validate' \\\\\n--header 'Authorization: Basic CHANGEME' \\\\\n--header 'Content-Type: application/json' \\\\\n--data-raw '{\n \"resourceType\": \"Parameters\",\n \"parameter\": [\n  {\n   \"name\": \"resource\",\n   \"resource\": {\n    \"resourceType\": \"Patient\",\n    \"id\": \"example\",\n    \"name\": [\n     {\n      \"use\": \"official\",\n      \"family\": \"Chalmers\",\n      \"given\": [\"Peter\", \"James\"]\n     }\n    ]\n   }\n  }\n ]\n}'\n`}</code></pre>\n    <p><em parentName=\"p\">{`Response`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"resourceType\": \"OperationOutcome\",\n  \"id\": \"NoError\",\n  \"text\": {\n    \"status\": \"additional\",\n    \"div\": \"<div xmlns=\\\\\"http://www.w3.org/1999/xhtml\\\\\"><p>No error</p></div>\"\n  },\n  \"issue\": [\n    {\n      \"severity\": \"warning\",\n      \"code\": \"invariant\",\n      \"details\": {\n        \"text\": \"dom-6: A resource should have narrative for robust management\"\n      },\n      \"expression\": [\n        \"Patient\"\n      ]\n    }\n  ]\n}\n`}</code></pre>\n    <h3>{`Example: Simple`}</h3>\n    <p><em parentName=\"p\">{`Request`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`curl --location --request GET 'https://localhost:9443/fhir-server/api/v4/$healthcheck' \\\\\n--header 'Authorization: Basic CHANGEME' \\\\\n--header 'Content-Type: application/json'\n`}</code></pre>\n    <p><em parentName=\"p\">{`Response`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"resourceType\": \"OperationOutcome\",\n  \"issue\": [\n    {\n      \"severity\": \"information\",\n      \"code\": \"informational\",\n      \"details\": {\n        \"text\": \"All OK\"\n      }\n    }\n  ]\n}\n`}</code></pre>\n    <h2>{`Inspecting a FHIR Server’s Capability Statement (Operations)`}</h2>\n    <p>{`Each FHIR server is expected to advertise its System, Type, and Instance-level operations in a CapabilityStatement resource served from the `}<inlineCode parentName=\"p\">{`[base]/metadata`}</inlineCode>{` endpoint.`}</p>\n    <p>{`To check the Type and Instance operations, you can use this curl/jq command.`}</p>\n    <p><inlineCode parentName=\"p\">{`curl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/metadata' | jq -r '.rest[].resource[].operation[].name' | sort -u`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{}}>{`apply\nclosure\nconvert\ndocument\nexpand\nexport\nlookup\nsubsumes\ntranslate\nvalidate\nvalidate-code\n`}</code></pre>\n    <p>{`To check the System Level operations, you can check using this curl/jq command.`}</p>\n    <p><inlineCode parentName=\"p\">{`curl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/metadata' | jq -r '.rest[].operation[].name'`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{}}>{`bulkdata-status\nclosure\nconvert\nexport\nhealthcheck\nhello\nimport\n`}</code></pre>\n    <h1>{`The Specification in More Detail`}</h1>\n    <p>{`Each Operation per `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/operations.html#defining\"\n      }}>{`the specification`}</a>{` is defined by an `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/operationdefinition.html\"\n      }}>{`OperationDefinition`}</a>{` resource.`}</p>\n    <p>{`The elements needed are:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Unique Name of the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.name`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"name\": \"import\"`}</inlineCode></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Code used to activate the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.code`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"code\": \"import\"`}</inlineCode></li>\n          <li parentName=\"ul\">{`The `}<em parentName=\"li\">{`code`}</em>{` is used in the CapabilityStatement.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`The Context - System, Type, Instance - `}<inlineCode parentName=\"li\">{`OperationDefinition.system`}</inlineCode>{`, `}<inlineCode parentName=\"li\">{`Operation.type`}</inlineCode>{`, `}<inlineCode parentName=\"li\">{`Operation.instance`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"system\": true`}</inlineCode></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Kind - always an `}<inlineCode parentName=\"li\">{`operation`}</inlineCode>{` - `}<inlineCode parentName=\"li\">{`OperationDefinition.kind`}</inlineCode></li>\n      <li parentName=\"ul\">{`Status - `}<inlineCode parentName=\"li\">{`OperationDefinition.status`}</inlineCode>{`, for implementers that are not intending to manage the lifecycle, best to put `}<inlineCode parentName=\"li\">{`draft`}</inlineCode></li>\n      <li parentName=\"ul\">{`Parameter - The list of parameters for the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.parameter`}</inlineCode>{` - `}<a parentName=\"li\" {...{\n          \"href\": \"https://hl7.org/fhir/R4B/operationdefinition-definitions.html#OperationDefinition.parameter\"\n        }}>{`Link`}</a>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Specificy your Query Parameter`}</li>\n          <li parentName=\"ul\">{`Be sure to have a return parameter`}</li>\n          <li parentName=\"ul\">{`Typically this is a FHIR Resource`}</li>\n        </ul>\n      </li>\n    </ul>\n    <h1>{`The LinuxForHealth Extended Operations Framework implementation`}</h1>\n    <p>{`The LinuxForHealth FHIR Server has integrated the Extended Operations Framework into the code base.`}</p>\n    <img {...{\n      \"src\": \"https://raw.githubusercontent.com/wiki/LinuxForHealth/FHIR/operation/operation-framework.png\",\n      \"alt\": \"Framework\"\n    }}></img>\n    <p>{`On startup, the FHIR Operation Registry uses the Java ServiceLoader framework. Each Operation is registered with the FHIROperationRegistry using `}<inlineCode parentName=\"p\">{`META-INF/services/com.ibm.fhir.server.operation.spi.FHIROperation`}</inlineCode>{` which lists each of the classes that implement the FHIROperation interface`}</p>\n    <p>{`For each implementation, the framework calls FHIROperation.getDefinition() to get the OperationDefinition and uses that do determine which endpoint to server the operation from (based on the defined operation levels, resource types, and “code”).`}</p>\n    <p>{`Upon receiving a request, the REST Layer checks to see if the JAX-RS path parameter `}<inlineCode parentName=\"p\">{`\\${operationName}`}</inlineCode>{` from a System, Type or Instance call is a registered Operation. If a FHIROperation exists in the registry with a “code” that matches the passed operationName, and it is valid for the level / resource type request, the framework calls FHIROperation.invoke() for that specific Operation type.`}</p>\n    <p>{`To make implementing custom operations easier, the LinuxForHealth FHIR Server provides an `}<inlineCode parentName=\"p\">{`AbstractOperation`}</inlineCode>{` class that provides input and output handling, while delegating to concrete implementations for the OperationDefinition and operation business logic.`}</p>\n    <p>{`For operations that are defined in the base FHIR specification, like `}<a parentName=\"p\" {...{\n        \"href\": \"https://hl7.org/fhir/R4B/resource-operation-validate.html\"\n      }}>{`$validate`}</a>{`, the OperationDefinition can be retrieved from the built-in `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/LinuxForHealth/FHIR/blob/6933926b8862d6515336f495e50ee7f66e5bcc15/operation/fhir-operation-validate/src/main/java/com/ibm/fhir/operation/validate/ValidateOperation.java#L40-L41\"\n      }}>{`FHIRRegistry`}</a>{`.`}</p>\n    <p>{`Note that once the Operation is loaded it is available until the server is restarted and redoes the ServiceLoader discovery.`}</p>\n    <h2>{`Code Examples`}</h2>\n    <p>{`There are a number of examples in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/LinuxForHealth/FHIR/tree/main/operation\"\n      }}>{`LinuxForHealth/FHIR repo`}</a>{`.`}</p>\n    <h2>{`Installation of an Operation`}</h2>\n    <p>{`The Operations are installed into the `}<inlineCode parentName=\"p\">{`userlib`}</inlineCode>{` folder of the LinuxForHealth FHIR Server. Some solutions are installing the operation as a layer in a docker image, or mount it as a volume.`}</p>\n    <img {...{\n      \"src\": \"https://raw.githubusercontent.com/wiki/LinuxForHealth/FHIR/operation/installation-location.png\",\n      \"alt\": \"install location\"\n    }}></img>\n    <h2>{`Building a FHIR Operation`}</h2>\n    <p>{`To build a FHIR Operation, a great starting point is the GitHub repo.`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Create a Maven Java project. Prefix the artifactid with `}<inlineCode parentName=\"li\">{`fhir-operation-`}</inlineCode>{` and give it a useful name, such as fhir-operation-myop.`}</li>\n      <li parentName=\"ol\">{`Add the relevant dependencies, such as `}<inlineCode parentName=\"li\">{`fhir-server`}</inlineCode>{`.\nThe pom.xml should look like:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>fhir-operation-myop</artifactId>\n\n    <parent>\n        <groupId>com.ibm.fhir</groupId>\n        <artifactId>fhir-parent</artifactId>\n        <version>4.4.1-SNAPSHOT</version>\n        <relativePath>../../fhir-parent</relativePath>\n    </parent>\n\n    <dependencies>\n        <dependency>\n  <groupId>\\${project.groupId}</groupId>\n  <artifactId>fhir-server</artifactId>\n  <version>\\${project.version}</version>\n        </dependency>\n    </dependencies>\n\n</project>\n`}</code></pre>\n    <p>{`Note, if you are using the persistence layer, you naturally get the fhir-persistence libraries as a dependency.\nNote, if you are including some custom libraries or other libraries, you should shade the dependencies into a single jar or deliverable.`}</p>\n    <ol {...{\n      \"start\": 3\n    }}>\n      <li parentName=\"ol\">{`Add your OperationDefinition to the `}<inlineCode parentName=\"li\">{`src/main/resources`}</inlineCode>{`, such as healthcare.json.`}</li>\n      <li parentName=\"ol\">{`Extend the AbstractOperation in your package, such as, `}<inlineCode parentName=\"li\">{`com.ibm.fhir.demo.MyOperation`}</inlineCode></li>\n      <li parentName=\"ol\">{`Create the Services Loader file `}<inlineCode parentName=\"li\">{`com.ibm.fhir.server.operation.spi.FHIROperation`}</inlineCode>{` in `}<inlineCode parentName=\"li\">{`src/main/resources/META-INF/services/`}</inlineCode></li>\n      <li parentName=\"ol\">{`Put a single line in the package for each of the Operations that are going to be hosted in the package.`}\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`com.ibm.fhir.demo.MyOperation\ncom.ibm.fhir.demo.DemoOperation\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">{`Add the constructor, such as:`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`    public HealthcheckOperation() {\n        super();\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 8\n    }}>\n      <li parentName=\"ol\">{`In the class extending the AbstractOperation, override the `}<inlineCode parentName=\"li\">{`buildOperationDefinition()`}</inlineCode>{` to load the OperationDefinition (note you could use the OperationDefinition.Builder to generate the configuration).`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`    protected OperationDefinition buildOperationDefinition() {\n        try (InputStream in = getClass().getClassLoader().getResourceAsStream(\"healthcheck.json\")) {\n  return FHIRParser.parser(Format.JSON).parse(in);\n        } catch (Exception e) {\n  throw new Error(e);\n        }\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 9\n    }}>\n      <li parentName=\"ol\">{`Override the `}<inlineCode parentName=\"li\">{`doInvoke`}</inlineCode>{`.`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`@Override\n    protected Parameters doInvoke(FHIROperationContext operationContext, Class<? extends Resource> resourceType, String logicalId, String versionId, Parameters parameters, FHIRResourceHelpers resourceHelper) throws FHIROperationException {\n        // Do Business Logic\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 10\n    }}>\n      <li parentName=\"ol\">{`Implement your business logic using the invoke Parameters. Every request is secured by a user-group and has an associated tenant/user.`}</li>\n    </ol>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Method Parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`How to use it`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`FHIROperationContext operationContext`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If you need access to the URI, HTTP Headers, Request Properties, GET or POST (and subsequent) setting of a response status or body, these are used for decision making`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Class<? extends Resource> resourceType`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance or type call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`String logicalId`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`String versionId`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Parameters parameters`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The input parameters used to trigger specific elements of the code path and used to help select outcomes`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`FHIRResourceHelpers resourceHelper`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Helper method to call Search using the REST interface (which is the easiest)`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <ol {...{\n      \"start\": 11\n    }}>\n      <li parentName=\"ol\">{`Return your response`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`return FHIROperationUtil.getOutputParameters(operationOutcome);\n`}</code></pre>\n    <p>{`If you return a single Resource in the Parameters object, the result is the single resource, such as a single OperationOutcome returned without the response Parameters.`}</p>\n    <h1>{`Tips and Tricks`}</h1>\n    <p>{`The following are some tips and tricks:`}</p>\n    <h2>{`Length of Interaction`}</h2>\n    <p>{`The framework is best suited for non-long poll requests such that an operation.`}</p>\n    <p>{`If you need to dispatch an operation, use two operations - one request operation, and one status/response operation.`}</p>\n    <h2>{`Transactions`}</h2>\n    <p>{`If you need to access the underlying persistence layer, you should request a transaction, and rollback or end it using on the FHIRPersistenceTransaction.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`  FHIRPersistence pl =\n(FHIRPersistence) operationContext.getProperty(FHIROperationContext.PROPNAME_PERSISTENCE_IMPL);\n\n  FHIRPersistenceTransaction tx = resourceHelper.getTransaction();\n  tx.begin();\n\n  try {\n      // Do Operation\n      return FHIROperationUtil.getOutputParameters(operationOutcome);\n  } catch (Throwable t) {\n      tx.setRollbackOnly();\n      throw t;\n  } finally {\n      tx.end();\n  }\n`}</code></pre>\n    <p>{`Naturally you’ll have access to any persistence operation which includes the RESTful actions - create, read, _vread, search, et cetra.`}</p>\n    <h2>{`Multitenancy`}</h2>\n    <p>{`By default, all tenants have access to an operation. Each Operation, if it has a multi-tenant requirement, must uses the FHIRRequestContext to get access to the Tenant Id and make a decision based on the id.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`  FHIRRequestContext ctx = FHIRRequestContext.get();\n  String tenantId = ctx.getTenantId();\n`}</code></pre>\n    <h2>{`Mutating the Response Code and Non-FHIR Resource Type responses`}</h2>\n    <p>{`To break out of the default response, use the `}<inlineCode parentName=\"p\">{`FHIROperationContext`}</inlineCode>{` which is ThreadSafe to mutate the Response.`}</p>\n    <p><em parentName=\"p\">{`Mutated Status`}</em></p>\n    <p><inlineCode parentName=\"p\">{`operationContext.setProperty(FHIROperationContext.PROPNAME_STATUS_TYPE, Response.Status.ACCEPTED);`}</inlineCode></p>\n    <p><em parentName=\"p\">{`Mutated Response`}</em>{` - Non-FHIR`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`Response response = Response.status(Status.OK).entity(PollingLocationResponse.Writer.generate(pollingResponse)).type(MediaType.APPLICATION_JSON).build();\noperationContext.setProperty(FHIROperationContext.PROPNAME_RESPONSE, response);\n`}</code></pre>\n    <p>{`You can return null as a Parameters object - `}<inlineCode parentName=\"p\">{`return FHIROperationUtil.getOutputParameters(null);`}</inlineCode></p>\n    <h1>{`Questions and Support`}</h1>\n    <p>{`If you need further support, you can reach out to the development team at:`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://chat.fhir.org/#narrow/stream/212434-LinuxForHealth\"\n        }}>{`Zulip: LinuxForHealth`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/LinuxForHealth/FHIR/issues\"\n        }}>{`GitHub: issues`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}