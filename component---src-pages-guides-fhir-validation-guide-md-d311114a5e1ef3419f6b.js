(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{JEla:function(e,t,r){"use strict";r.r(t),r.d(t,"_frontmatter",(function(){return l})),r.d(t,"default",(function(){return h}));r("tkto"),r("yXV3"),r("pNMO"),r("zKZe"),r("q1tI");var i=r("7ljp"),n=r("013z"),a=(r("qKvR"),["components"]);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l={},c={_frontmatter:l},p=n.a;function h(e){var t=e.components,r=s(e,a);return Object(i.b)(p,o({},c,r,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",null,"Overview"),Object(i.b)("p",null,"The IBM FHIR Server validation module (",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-validation"},"fhir-validation"),") provides Java APIs for validating FHIR resources using constraints specified in their corresponding structure definitions."),Object(i.b)("p",null,"The validation module is available from our ",Object(i.b)("a",{parentName:"p",href:"https://github.com/ibm/fhir#building-on-top-of-the-ibm-fhir-server-modules"},"Maven artifact repository")," and is also packaged together with its dependencies and all of our pre-packaged implementation guides in the ",Object(i.b)("inlineCode",{parentName:"p"},"fhir-validation-distribution.zip")," artifact which may be downloaded from ",Object(i.b)("a",{parentName:"p",href:"releases"},"https://github.com/IBM/FHIR/releases"),"."),Object(i.b)("h2",null,"How it works"),Object(i.b)("p",null,"The IBM FHIR Server validation module evaluates constraints from both the core specification and from structure definitions that are available at runtime.\nFor example, in the Patient resource, we have the following constraint:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'@Constraint(\n    id = "pat-1",\n    level = "Rule",\n    location = "Patient.contact",\n    description = "SHALL at least contain a contact\'s details or a reference to an organization",\n    expression = "name.exists() or telecom.exists() or address.exists() or organization.exists()"\n)\n')),Object(i.b)("p",null,"The validation component picks up the Java annotation, pulls out the FHIRPath expression and passes it on to the IBM FHIR Server FHIRPath component (",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-path"},"fhir-path"),") for evaluation. If the invariant evaluates to ",Object(i.b)("inlineCode",{parentName:"p"},"false")," then the FHIR validator will generate an OperationOutcome.Issue with the severity set relative to the “level” of the constraint (i.e. “Rule” or “Warning”);"),Object(i.b)("img",{src:"https://ibm.github.io/FHIR/images/fhir-dependency-graph.png",alt:"https://ibm.github.io/FHIR/images/fhir-dependency-graph.png"}),Object(i.b)("h2",null,"Profile Support"),Object(i.b)("p",null,"The validation component will also validate a resource against profiles that it asserts conformance to in the ",Object(i.b)("inlineCode",{parentName:"p"},"Resource.meta.profile")," element assuming those profiles are available to the IBM FHIR Server via the FHIR registry component (",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-registry"},"fhir-registry"),") at runtime."),Object(i.b)("p",null,"Given a FHIR profile (structure definition) that contains a Snapshot as input, the IBM FHIR Server Profile component (",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-profile"},"fhir-profile"),") generates FHIRPath expressions for a number of different types of constraints. The current scope of constraint generation is:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Cardinality constraints (required and prohibited elements)"),Object(i.b)("li",{parentName:"ul"},"Fixed value constraints (Code and Uri data types)"),Object(i.b)("li",{parentName:"ul"},"Pattern value constraints (CodeableConcept and Identifier data types)"),Object(i.b)("li",{parentName:"ul"},"Reference type constraints (FHIRPath resolve/is/conformsTo functions)"),Object(i.b)("li",{parentName:"ul"},"Extension constraints (FHIRPath ",Object(i.b)("inlineCode",{parentName:"li"},"conformsTo")," function)"),Object(i.b)("li",{parentName:"ul"},"Vocabulary constraints (FHIRPath ",Object(i.b)("inlineCode",{parentName:"li"},"memberOf")," function)"),Object(i.b)("li",{parentName:"ul"},"Choice type constraints (FHIRPath ",Object(i.b)("inlineCode",{parentName:"li"},"as")," function)")),Object(i.b)("p",null,"NOTE: there is currently no support for ",Object(i.b)("inlineCode",{parentName:"p"},"closed")," or ",Object(i.b)("inlineCode",{parentName:"p"},"ordered")," slices."),Object(i.b)("p",null,"For example, the HL7 bodyweight profile has the following cardinality and fixed value constraints (some details removed for brevity):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "Observation.code.coding:BodyWeightCode.system",\n    "path": "Observation.code.coding.system",\n    "min": 1,\n    "max": "1",\n    "type": [{\n        "code": "uri"\n    }],\n    "fixedUri": "http://loinc.org"\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "Observation.code.coding:BodyWeightCode.code",\n    "path": "Observation.code.coding.code",\n    "min": 1,\n    "max": "1",\n    "type": [{\n        "code": "code"\n    }],\n    "fixedCode": "29463-7",\n}\n')),Object(i.b)("p",null,"which are used by the ConstraintGenerator to generate the following FHIRPath expression:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"code.where(coding.where(system = 'http://loinc.org' and code = '29463-7').exists()).exists()\n")),Object(i.b)("p",null,"The HL7 bodyweight profile has the following reference type constraint (some details removed for brevity):"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "Observation.subject",\n    "path": "Observation.subject",\n    "type": [{\n        "code": "Reference",\n        "targetProfile": [\n            "http://hl7.org/fhir/StructureDefinition/Patient"\n        ]\n    }]      \n}\n')),Object(i.b)("p",null,"which is used by the ConstraintGenerator to generate the following FHIRPath expression:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"subject.resolve().is(Patient)\n")),Object(i.b)("p",null,"Complex reference types are also supported, for example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"derivedFrom.exists() implies (derivedFrom.all(resolve().is(DocumentReference) or resolve().is(ImagingStudy) or resolve().is(Media) or resolve().is(QuestionnaireResponse) or resolve().is(MolecularSequence) or resolve().conformsTo('http://hl7.org/fhir/StructureDefinition/vitalsigns')))\n")),Object(i.b)("p",null,"is generated from the element definition ",Object(i.b)("inlineCode",{parentName:"p"},"Observation.derivedFrom")," in the same bodyweight profile."),Object(i.b)("p",null,"FHIRPath based constraints specified in ",Object(i.b)("inlineCode",{parentName:"p"},"StructureDefinition.snapshot.element.constraint")," elements, will also be evaluated during profile validation. All of the constraints generated for a given profile are cached in memory so that they can be reused to validate multiple resources that are asserting conformance to the same profile."),Object(i.b)("h3",null,"Making profiles available to the FHIR registry component (FHIRRegistry)"),Object(i.b)("p",null,"The FHIR registry component keeps track of definitional resource types (e.g. StructureDefinition, ValueSet, CodeSystem, etc.). It uses the Java ServiceLoader to look for implementations of the FHIRRegistryResourceProvider interface:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"public interface FHIRRegistryResourceProvider {\n    /**\n     * Get the registry resource from this provider for the given resource type, url and version\n     *\n     * <p>If the version is null, then the latest version of the registry resource is returned (if available)\n     *\n     * @param resourceType\n     *     the resource type of the registry resource\n     * @param url\n     *     the url of the registry resource\n     * @param version\n     *     the version of the registry resource (optional)\n     * @return\n     *     the registry resource from this provider for the given resource type, url and version if exists, null otherwise\n     */\n    FHIRRegistryResource getRegistryResource(Class<? extends Resource> resourceType, String url, String version);\n\n    /**\n     * Get the registry resources from this provider for the given resource type\n     *\n     * @param resourceType\n     *     the resource type of the registry resource\n     * @return\n     *     the registry resources from this provider for the given resource type\n     */\n    Collection<FHIRRegistryResource> getRegistryResources(Class<? extends Resource> resourceType);\n\n    /**\n     * Get all the registry resources from this provider\n     *\n     * @return\n     *     all of the registry resources from this provider\n     */\n    Collection<FHIRRegistryResource> getRegistryResources();\n\n    /**\n     * Get the profile resources from this provider that constrain the given resource type\n     *\n     * @param type\n     *     the constrained resource type\n     * @return\n     *     the profile resources from this provider that constrain the given resource type\n     */\n    Collection<FHIRRegistryResource> getProfileResources(String type);\n\n\n    /**\n     * Get the search parameter resources from this provider with the given search parameter type\n     * (e.g. string, token, etc.)\n     *\n     * @param type\n     *     the search parameter type\n     * @return\n     *     the search parameter resources from this provider with the given search parameter type\n     */\n    Collection<FHIRRegistryResource> getSearchParameterResources(String type);\n}\n")),Object(i.b)("p",null,"Package your implementation in a jar file and be sure to include its fully-qualified classname in your jar’s\n",Object(i.b)("inlineCode",{parentName:"p"},"META-INF/services/com.ibm.fhir.registry.spi.FHIRRegistryResourceProvider"),", then drop this jar in the server’s userlib directory to make it available to the server during startup."),Object(i.b)("h3",null,"NPM package format support"),Object(i.b)("p",null,"The IBM FHIR Server Registry module (",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-registry"},"fhir-registry"),") has utilities that can be used to expose FHIR registry resources that exist in the NPM package format. Implementation guides that follow this packaging format can be dropped into the ",Object(i.b)("inlineCode",{parentName:"p"},"src/main/resources/")," under a directory structure defined by the ImplementationGuide.packageId value. For example, US Core implementation guide has a package id of: ",Object(i.b)("inlineCode",{parentName:"p"},"hl7.fhir.us.core"),". The NPM “package” folder can be dropped here: ",Object(i.b)("inlineCode",{parentName:"p"},"src/main/resources/hl7/fhir/us/core/package")),Object(i.b)("img",{src:"https://ibm.github.io/FHIR/images/us-core-package.png",alt:"https://ibm.github.io/FHIR/images/us-core-package.png"}),Object(i.b)("p",null,"For convenience, we have created a base implementation of ",Object(i.b)("inlineCode",{parentName:"p"},"FHIRRegistryResourceProvider")," called ",Object(i.b)("inlineCode",{parentName:"p"},"PackageRegistryResourceProvider"),". The implementation of the ",Object(i.b)("inlineCode",{parentName:"p"},"USCoreResourceProvider")," using this implementation looks like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},'public class USCoreResourceProvider extends PackageRegistryResourceProvider {\n    @Override\n    public String getPackageId() {\n        return "hl7.fhir.us.core";\n    }\n}\n')),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"PackgageRegistryResourceProvider")," class converts the packageId (e.g. hl7.fhir.us.core) to a path where it can find the NPM package index file: ",Object(i.b)("inlineCode",{parentName:"p"},".index.json"),". The ",Object(i.b)("inlineCode",{parentName:"p"},"PackageRegistryResourceProvider")," class creates ",Object(i.b)("inlineCode",{parentName:"p"},"FHIRRegistryResource")," instances, using the index file, and caches them in a map on startup. The ",Object(i.b)("inlineCode",{parentName:"p"},"PackageRegistryResource")," (an implementation of ",Object(i.b)("inlineCode",{parentName:"p"},"FHIRRegistryResource")," class lazily loads the underlying FHIR resource into memory when it is accessed. Multiple versions of the same resource can be registered. FHIR registry resource providers can be bundled into a jar file and deployed with the IBM FHIR server in the user lib directory."),Object(i.b)("p",null,"The IBM FHIR Server uses the Snapshot and not the Differential, you must include a Snapshot. As mentioned in ",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/issues/2829"},"#2829"),", you may use FHIR Sushi with the ",Object(i.b)("inlineCode",{parentName:"p"},"-s")," option to generate a Snapshot."),Object(i.b)("p",null,"For more information, please see: ",Object(i.b)("a",{parentName:"p",href:"https://confluence.hl7.org/display/FHIR/NPM+Package+Specification"},"https://confluence.hl7.org/display/FHIR/NPM+Package+Specification")),Object(i.b)("h3",null,"Built-in profile support"),Object(i.b)("p",null,"The IBM FHIR server has built-in support for the following:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Profiles defined in the base FHIR Specification (v4.0.1: R4 - Mixed Normative and STU) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/profilelist.html"},"http://hl7.org/fhir/profilelist.html"))),Object(i.b)("h3",null,"Optional profile support"),Object(i.b)("p",null,"The IBM FHIR server has additional implementation guides available in the fhir-validation-distribution.zip artifact, which may be downloaded from ",Object(i.b)("a",{parentName:"p",href:"releases"},"https://github.com/IBM/FHIR/releases"),". To load an additional implemenation guide, copy the implementation guide’s jar (e.g. ",Object(i.b)("inlineCode",{parentName:"p"},"fhir-ig-us-core-VERSION.jar"),") from the fhir-validation-distribution.zip artifact into the IBM FHIR server’s userlib directory to make it available to the server during startup."),Object(i.b)("p",null,"The latest version of the fhir-validation-distribution.zip artifact includes the following implementation guides:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"US Core Implementation Guide (v3.1.1: STU3 Update) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/core/STU3.1.1/"},"http://hl7.org/fhir/us/core/STU3.1.1/")),Object(i.b)("li",{parentName:"ul"},"CARIN Consumer Directed Payer Data Exchange (CARIN IG for BlueButton®) Implementation Guide (v1.0.0 - STU1) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/carin-bb/STU1"},"http://hl7.org/fhir/us/carin-bb/STU1")),Object(i.b)("li",{parentName:"ul"},"HL7 FHIR Implementation Guide: minimal Common Oncology Data Elements (mCODE) Release 1 - US Realm | STU1 (v1.0.0 - STU1) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/mcode/STU1"},"http://hl7.org/fhir/us/mcode/STU1")),Object(i.b)("li",{parentName:"ul"},"Da Vinci Health Record Exchange (HREX) Implementation Guide (v1.0.0 - STU1) [",Object(i.b)("a",{parentName:"li",href:"https://hl7.org/fhir/us/davinci-hrex/STU1"},"https://hl7.org/fhir/us/davinci-hrex/STU1"),")"),Object(i.b)("li",{parentName:"ul"},"Da Vinci Payer Data Exchange (PDEX) Implementation Guide (v1.0.0 - STU1) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/davinci-pdex/STU1"},"http://hl7.org/fhir/us/davinci-pdex/STU1")),Object(i.b)("li",{parentName:"ul"},"Da Vinci Payer Data Exchange (PDEX) Plan Net Implementation Guide (v1.0.0 - STU1) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/davinci-pdex-plan-net/STU1"},"http://hl7.org/fhir/us/davinci-pdex-plan-net/STU1")),Object(i.b)("li",{parentName:"ul"},"Da Vinci Payer Data Exchange (PDex) US Drug Formulary (v1.0.1 - STU1.0.1) ",Object(i.b)("a",{parentName:"li",href:"http://hl7.org/fhir/us/davinci-drug-formulary/STU1.0.1"},"http://hl7.org/fhir/us/davinci-drug-formulary/STU1.0.1"))),Object(i.b)("h2",null,"The IBM FHIR Server $validate operation"),Object(i.b)("p",null,"The IBM FHIR Server provides a basic implementation of the $validate operation that invokes the FHIRValidator via a REST API. By default, the $validate operation will validate a resource against the base specification and any profiles asserted in its ",Object(i.b)("inlineCode",{parentName:"p"},"Resource.meta.profile")," element. The default behavior may be changed in one of the following ways:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"If a profile is specified via the optional ",Object(i.b)("inlineCode",{parentName:"li"},"profile")," parameter, the $validate operation will validate a resource against the base specification and the specified profile only. It will not validate against any profiles asserted in the ",Object(i.b)("inlineCode",{parentName:"li"},"Resource.meta.profile")," element."),Object(i.b)("li",{parentName:"ul"},"If the ",Object(i.b)("inlineCode",{parentName:"li"},"profile")," parameter is not specified, but the ",Object(i.b)("inlineCode",{parentName:"li"},"mode")," parameter is specified, and the ",Object(i.b)("inlineCode",{parentName:"li"},"mode")," parameter value is either ",Object(i.b)("inlineCode",{parentName:"li"},"create")," or ",Object(i.b)("inlineCode",{parentName:"li"},"update"),", the $validate operation will validate a resource against the base specification and any profiles asserted in its ",Object(i.b)("inlineCode",{parentName:"li"},"Resource.meta.profile")," element, but will do so based on profile configuration properties specified in the ",Object(i.b)("inlineCode",{parentName:"li"},"fhirServer/resources/<resourceType>/profiles")," section of the ",Object(i.b)("inlineCode",{parentName:"li"},"fhir-server-config.json")," file (see the ",Object(i.b)("a",{parentName:"li",href:"https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#51-configuration-properties-reference"},"user guide")," for configuration details).")),Object(i.b)("h2",null,"ValueSet membership checking (FHIRPath ",Object(i.b)("inlineCode",{parentName:"h2"},"memberOf")," function)"),Object(i.b)("p",null,"Coded elements (code, Coding, CodeableConcept data types), maybe have a binding element that specifies a ValueSet that that element is bound to. This means that the coded element must have a value that comes from that value set. The FHIR profile component will expand value sets according to the ValueSet ",Object(i.b)("a",{parentName:"p",href:"http://hl7.org/fhir/valueset.html#expansion"},"expansion algorithm")," for ValueSets that include CodeSystem resources available via the FHIR registry component."),Object(i.b)("h2",null,"fhir-path-cli - command line execution of fhirpath over a FHIR Resource"),Object(i.b)("p",null,"The fhir-path-cli enables commandline processing of a FHIR Path over a FHIR resource and outputs the results."),Object(i.b)("p",null,"For details on the fhir-path-cli, refer to the ",Object(i.b)("a",{parentName:"p",href:"https://github.com/IBM/FHIR/tree/main/fhir-path/README.md"},"README.md")))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-fhir-validation-guide-md-d311114a5e1ef3419f6b.js.map