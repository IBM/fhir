{
    "__comment": "FHIR Server configuration",
    "fhirServer": {
        "core": {
            "tenantIdHeaderName": "X-FHIR-TENANT-ID",
            "datastoreIdHeaderName": "X-FHIR-DSID",
            "originalRequestUriHeaderName": "X-FHIR-FORWARDED-URL",
            "checkReferenceTypes": true,
            "conditionalDeleteMaxNumber": 10,
            "serverRegistryResourceProviderEnabled": true,
            "disabledOperations": ""
        },
        "resources": {
            "open": false,
            "Coverage": {
                "searchIncludes": [
                    "Coverage:payor"
                ],
                "searchRevIncludes": [
                    "Provenance:target"
                ],
                "profiles": {
                    "atLeastOne": [
                        "http://hl7.org/fhir/us/carin-bb/StructureDefinition/C4BB-Coverage",
                        "http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-coverage"
                    ],
                    "defaultVersions": {
                        "http://hl7.org/fhir/us/carin-bb/StructureDefinition/C4BB-Coverage": "1.0.0",
                        "http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-coverage": "0.2.0"
                    }
                },
                "searchParameters": {
                    "beneficiary": "http://hl7.org/fhir/SearchParameter/Coverage-beneficiary",
                    "identifier": "http://hl7.org/fhir/us/davinci-hrex/SearchParameter/hrex-coverage-identifier",
                    "patient": "http://hl7.org/fhir/us/davinci-hrex/SearchParameter/hrex-coverage-patient",
                    "payor": "http://hl7.org/fhir/us/carin-bb/SearchParameter/coverage-payor",
                    "policy-holder": "http://hl7.org/fhir/SearchParameter/Coverage-policy-holder",
                    "subscriber": "http://hl7.org/fhir/SearchParameter/Coverage-subscriber",
                    "subscriberId": "http://hl7.org/fhir/us/davinci-hrex/SearchParameter/hrex-coverage-subscriberId",
                    "period": "http://ibm.com/health-interop/fhir/SearchParameter/Coverage-period",
                    "status": "http://hl7.org/fhir/SearchParameter/Coverage-status"
                }
            },
            "Patient": {
                "searchIncludes": [
                    "Patient:general-practitioner",
                    "Patient:organization"
                ],
                "searchRevIncludes": [
                    "Provenance:target"
                ],
                "profiles": {
                    "atLeastOne": [
                        "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient",
                        "http://hl7.org/fhir/us/carin-bb/StructureDefinition/C4BB-Patient"
                    ],
                    "defaultVersions": {
                        "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient": "3.1.1",
                        "http://hl7.org/fhir/us/carin-bb/StructureDefinition/C4BB-Patient": "1.0.0"
                    }
                },
                "searchParameters": {
                    "_id": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-id",
                    "address": "http://hl7.org/fhir/SearchParameter/individual-address",
                    "address-city": "http://hl7.org/fhir/SearchParameter/individual-address-city",
                    "address-country": "http://hl7.org/fhir/SearchParameter/individual-address-country",
                    "address-postalcode": "http://hl7.org/fhir/SearchParameter/individual-address-postalcode",
                    "address-state": "http://hl7.org/fhir/SearchParameter/individual-address-state",
                    "birthdate": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-birthdate",
                    "family": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-family",
                    "gender": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-gender",
                    "general-practitioner": "http://hl7.org/fhir/SearchParameter/Patient-general-practitioner",
                    "given": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-given",
                    "identifier": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-identifier",
                    "language": "http://hl7.org/fhir/SearchParameter/Patient-language",
                    "link": "http://hl7.org/fhir/SearchParameter/Patient-link",
                    "name": "http://hl7.org/fhir/us/core/SearchParameter/us-core-patient-name",
                    "organization": "http://hl7.org/fhir/SearchParameter/Patient-organization",
                    "telecom": "http://hl7.org/fhir/SearchParameter/individual-telecom"
                }
            },
            "Resource": {
                "searchParameters": {
                    "_id": "http://hl7.org/fhir/SearchParameter/Resource-id",
                    "_lastUpdated": "http://hl7.org/fhir/SearchParameter/Resource-lastUpdated",
                    "_profile": "http://hl7.org/fhir/SearchParameter/Resource-profile",
                    "_security": "http://hl7.org/fhir/SearchParameter/Resource-security",
                    "_source": "http://hl7.org/fhir/SearchParameter/Resource-source",
                    "_tag": "http://hl7.org/fhir/SearchParameter/Resource-tag"
                },
                "profiles": {
                    "allowUnknown": false
                }
            }
        },
        "search": {
            "useStoredCompartmentParam": true
        },
        "security": {
            "cors": true,
            "basic": {
                "enabled": true
            },
            "certificates": {
                "enabled": true
            },
            "oauth": {
                "enabled": false,
                "regUrl": "https://<host>:9443/oauth2/endpoint/oauth2-provider/registration",
                "authUrl": "https://<host>:9443/oauth2/endpoint/oauth2-provider/authorize",
                "tokenUrl": "https://<host>:9443/oauth2/endpoint/oauth2-provider/token",
                "smart": {
                    "enabled": false,
                    "scopes": ["openid", "profile", "fhirUser", "launch/patient", "patient/*.*", "offline_access"],
                    "capabilities": [
                        "sso-openid-connect",
                        "launch-standalone",
                        "client-public",
                        "client-confidential-symmetric",
                        "permission-offline",
                        "context-standalone-patient",
                        "permission-patient"
                    ]
                }
            }
        },
        "notifications": {
            "common": {
                "__comment_includeResourceTypes": [
                    "QuestionnaireResponse",
                    "CarePlan",
                    "MedicationAdministration",
                    "Device",
                    "DeviceComponent",
                    "DeviceMetric",
                    "MedicationOrder",
                    "Observation"
                ]
            },
            "websocket": {
                "__comment": "only enable this for single-tenant, single-server deployments",
                "enabled": false
            },
            "kafka": {
                "enabled": false,
                "topicName": "fhirNotifications",
                "connectionProperties": {
                    "group.id": "securing-kafka-group",
                    "bootstrap.servers": "localhost:9093",
                    "security.protocol": "SSL",
                    "ssl.truststore.location": "resources/security/kafka.client.truststore.p12",
                    "ssl.truststore.password": "change-password",
                    "ssl.keystore.location": "resources/security/kafka.client.keystore.p12",
                    "ssl.keystore.password": "change-password",
                    "ssl.key.password": "change-password",
                    "ssl.truststore.type": "PKCS12",
                    "ssl.keystore.type": "PKCS12",
                    "acks": "all",
                    "retries": "60",
                    "request.timeout.ms": "10000",
                    "max.block.ms": "60000",
                    "max.in.flight.requests.per.connection": "5"
                }
            },
            "nats": {
                "enabled": false,
                "cluster": "nats-streaming",
                "channel": "fhirNotifications",
                "clientId": "fhir-server",
                "servers": "nats://nats-node1:4222,nats://nats-node2:4222,nats://nats-node3:4222",
                "useTLS": false,
                "truststoreLocation": "resources/security/nats.client.truststore.jks",
                "truststorePassword": "change-password",
                "keystoreLocation": "resources/security/nats.client.keystore.jks",
                "keystorePassword": "change-password"
            }
        },
        "audit": {
            "serviceClassName" : "com.ibm.fhir.audit.impl.NopService",
            "serviceProperties" : {
            }
        },
        "persistence": {
            "factoryClassname": "com.ibm.fhir.persistence.jdbc.FHIRPersistenceJDBCFactory",
            "common": {
                "__comment": "Configuration properties common to all persistence layer implementations",
                "updateCreateEnabled": true
            },
            "jdbc": {
                "__comment": "Configuration properties for the JDBC persistence implementation",
                "enableCodeSystemsCache": true,
                "enableParameterNamesCache": true,
                "enableResourceTypesCache": true
            },
            "datasources": {
                "default": {
                    "jndiName": "jdbc/bootstrap_default_default",
                    "type": "derby",
                    "currentSchema": "APP"
                },
                "_db2sample": {
                    "type": "db2",
                    "tenantKey": "<the-tenant-key>",
                    "currentSchema": "fhirdata",
                    "hints" : {
                      "search.reopt": "ONCE"
                    }
                },
                "_pgsample": {
                    "type": "postgresql",
                    "currentSchema": "fhirdata",
                    "searchOptimizerOptions": {
                        "from_collapse_limit": 12,
                        "join_collapse_limit": 12
                    }
                }
            }
        },
        "bulkdata": {
            "enabled": true,
            "core": {
                "api": {
                    "url": "https://localhost:9443/ibm/api/batch",
                    "user": "fhiradmin",
                    "password": "change-password",
                    "truststore": "resources/security/fhirTrustStore.p12",
                    "truststorePassword": "change-password", 
                    "trustAll": true
                },
                "cos" : { 
                    "partUploadTriggerSizeMB": 10,
                    "objectSizeThresholdMB": 200,
                    "objectResourceCountThreshold": 200000,
                    "useServerTruststore": true,
                    "presignedExpiry": 86400
                },
                "file" : { 
                    "writeTriggerSizeMB": 1,
                    "sizeThresholdMB": 200,
                    "resourceCountThreshold": 200000
                },
                "pageSize": 100,
                "batchIdEncryptionKey": "change-password",
                "maxPartitions": 3, 
                "maxInputs": 5,
                "maxChunkReadTime": "90000",
                "systemExportImpl": "fast",
                "defaultExportProvider": "default",
                "defaultImportProvider": "default"
            },
            "storageProviders": {
                "default" : {
                    "type": "file",
                    "_type": "ibm-cos|aws-s3|file|https|azure-blob",
                    "validBaseUrls": [],
                    "fileBase": "/output/bulkdata",
                    "bucketName": "fhir-performance",
                    "location": "us",
                    "endpointInternal": "https://s3.us-east.cloud-object-storage.appdomain.cloud",
                    "endpointExternal": "https://s3.us-east.cloud-object-storage.appdomain.cloud",
                    "auth" : {
                        "type": "hmac",
                        "accessKeyId": "key",
                        "secretAccessKey": "secret"
                    },
                    "_iam_auth" : {
                        "type": "iam",
                        "iamApiKey": "apiKey",
                        "iamResourceInstanceId": "resourceId"
                    },
                    "enableParquet": false,
                    "disableBaseUrlValidation": true,
                    "disableOperationOutcomes": true,
                    "duplicationCheck": false, 
                    "validateResources": false, 
                    "create": false,
                    "presigned": true
                }
            }
        },
        "operations": {
            "erase": {
                "enabled": true,
                "allowedRoles": [
                    "FHIROperationAdmin",
                    "FHIRUsers"
                ]
            }
        }
    }
}
